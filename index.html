<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Musicy</title>
<style>
  body {
    margin: 0;
    font-family: sans-serif;
    background: linear-gradient(#7b2d9f, #7b2d9f);
    color: white;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  header {
    padding: 20px;
    font-size: 2rem;
    font-weight: bold;
    text-align: center;
  }
  .controls {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 20px;
  }
  .controls button {
    background-color: #2c0a71;
    border: none;
    border-radius: 999px;
    padding: 10px 16px;
    color: white;
    font-weight: bold;
    font-size: 1rem;
    cursor: pointer;
  }
  .grid {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-bottom: 20px;
  }
  .track-row {
    display: flex;
    gap: 8px;
    justify-content: center;
    flex-wrap: nowrap;
  }
  .cell {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    background: rgba(255,255,255,0.1);
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
  }
  .cell.active svg polygon,
  .cell.active svg ellipse {
    fill: #2c0a71;
    stroke: none;
  }
  svg {
    width: 36px;
    height: 36px;
  }
  footer {
    font-size: 0.8rem;
    opacity: 0.8;
    margin: 20px;
    text-align: center;
  }
  @media(max-width:480px){
    .cell { width: 36px; height: 36px; }
    svg { width: 28px; height: 28px; }
  }
</style>
</head>
<body>
<header>Musicy</header>

<div class="controls">
  <button id="playBtn">Play</button>
  <button id="randomBtn">Random</button>
  <button id="clearBtn">Clear</button>
</div>

<div class="grid" id="grid"></div>

<footer>Made with WebAudio • Shapes: ovals & triangles • Theme: #7b2d9f / #2c0a71</footer>

<script>
const TRACKS = ['Bass', 'Beat', 'Layer', 'Tone'];
const STEPS = 16;
let pattern = TRACKS.map(() => Array(STEPS).fill(false));
let currentStep = 0;
let isPlaying = false;
let timer = null;
let audioCtx = null;

// Build grid
const gridEl = document.getElementById('grid');
TRACKS.forEach((track, r) => {
  const rowEl = document.createElement('div');
  rowEl.className = 'track-row';
  for(let c=0;c<STEPS;c++){
    const cell = document.createElement('div');
    cell.className = 'cell';
    cell.dataset.row = r;
    cell.dataset.col = c;
    const svg = document.createElementNS("http://www.w3.org/2000/svg","svg");
    if(track==='Beat'){
      const tri = document.createElementNS("http://www.w3.org/2000/svg","polygon");
      tri.setAttribute("points","50,12 88,88 12,88");
      tri.setAttribute("stroke","#2c0a71");
      tri.setAttribute("fill","none");
      svg.appendChild(tri);
    } else {
      const oval = document.createElementNS("http://www.w3.org/2000/svg","ellipse");
      oval.setAttribute("cx","50");
      oval.setAttribute("cy","50");
      oval.setAttribute("rx","40");
      oval.setAttribute("ry","26");
      oval.setAttribute("stroke","#2c0a71");
      oval.setAttribute("fill","none");
      oval.setAttribute("stroke-width","4");
      svg.appendChild(oval);
    }
    cell.appendChild(svg);
    rowEl.appendChild(cell);
    // toggle cell on click
    cell.addEventListener('click', ()=> {
      pattern[r][c] = !pattern[r][c];
      cell.classList.toggle('active');
    });
  }
  gridEl.appendChild(rowEl);
});

// Simple WebAudio sounds
function playStep(step){
  if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)();
  TRACKS.forEach((track,r)=>{
    if(pattern[r][step]){
      const osc = audioCtx.createOscillator();
      osc.type = r===0?'sawtooth':'triangle';
      osc.frequency.value = r===1?150: r===2?220: 330;
      const gain = audioCtx.createGain();
      gain.gain.setValueAtTime(0.2,audioCtx.currentTime);
      osc.connect(gain).connect(audioCtx.destination);
      osc.start();
      osc.stop(audioCtx.currentTime+0.15);
    }
  });
}

// Play loop
function startStop(){
  if(!isPlaying){
    isPlaying = true;
    timer = setInterval(()=>{
      playStep(currentStep);
      currentStep = (currentStep+1)%STEPS;
    }, 200);
    document.getElementById('playBtn').innerText='Pause';
  } else {
    isPlaying=false;
    clearInterval(timer);
    timer=null;
    document.getElementById('playBtn').innerText='Play';
  }
}

// Random & clear
function randomize(){
  pattern = TRACKS.map(()=>Array.from({length:STEPS},()=>Math.random()<0.3));
  document.querySelectorAll('.cell').forEach((cell)=>{
    const r = cell.dataset.row, c=cell.dataset.col;
    if(pattern[r][c]) cell.classList.add('active'); else cell.classList.remove('active');
  });
}
function clearAll(){
  pattern = TRACKS.map(()=>Array(STEPS).fill(false));
  document.querySelectorAll('.cell').forEach(cell=>cell.classList.remove('active'));
}

// Bind buttons
document.getElementById('playBtn').addEventListener('click', startStop);
document.getElementById('randomBtn').addEventListener('click', randomize);
document.getElementById('clearBtn').addEventListener('click', clearAll);
</script>
</body>
</html>
